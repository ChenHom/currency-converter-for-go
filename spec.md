# 主旨：將貨幣轉換程式強化為符合生產環境的完整解決方案

---

## **1. 動態匯率來源**

### **目標**

匯率資料應來自可靠的第三方服務，確保準確性和即時性，而非硬編碼。

### **實作細節**

- **概念**：
  - **REST API**：透過 HTTP 通訊協定從外部匯率提供商獲取資料。
  - **JSON 解析**：從 API 回應中解析匯率資料。
  - **快取策略**：引入快取避免過多 API 請求，降低延遲與成本。
- **資料來源建議**：
  - **OpenExchangeRates** 或 **Fixer.io** 等服務。
  - 免費方案和付費方案，根據需求選擇。
- **挑戰與解決方案**：
  - **API 不可用**：設計降級方案（如使用本地快取或預設匯率）。
  - **匯率更新頻率**：根據應用場景設置更新間隔（如 15 分鐘）。

---

## **2. 設定與設定管理**

### **目標**

將敏感資訊（如 API 金鑰）和設定分離，避免硬編碼。

### **實作細節**

- **概念**：
  - **環境變數**：使用 `.env` 文件或系統環境變數儲存敏感資料。
  - **設定文件**：引入 YAML/JSON 檔案，管理非敏感性設定（如支援的貨幣列表）。
- **關鍵設計**：
  - 使用環境變數儲存 API 金鑰、基礎 URL。
  - 設置預設貨幣及本地化選項，透過設定文件載入。
- **工具建議**：
  - **godotenv**：自動載入 `.env` 文件的環境變數。
  - **Viper**：靈活管理設定文件。

---

## **3. 日誌與監控**

### **目標**

提供清晰的操作記錄與錯誤追蹤，方便追查問題。

### **實作細節**

- **概念**：
  - **日誌等級**：分為 `INFO`、`WARN`、`ERROR`，不同場景記錄不同的訊息。
  - **集中化監控**：結合 ELK 堆疊（Elasticsearch、Logstash、Kibana）收集和分析日誌。
- **日誌內容**：
  - 匯率更新成功或失敗的記錄。
  - 每次金額轉換的操作記錄（包括使用的匯率）。
  - 系統錯誤或異常情況的詳細描述。
- **工具建議**：
  - **logrus** 或 **zap**：高效的日誌記錄工具。
  - **分散式追蹤**：引入 Jaeger 或 Zipkin 以追蹤分散式請求。

---

## **4. 錯誤處理與用戶體驗**

### **目標**

讓系統能穩健運行，即使遇到問題也能優雅降級，提供友好的用戶體驗。

### **實作細節**

- **概念**：
  - **降級機制**：匯率 API 不可用時使用本地快取。
  - **錯誤重試**：在短暫的網路問題下自動重新嘗試。
  - **用戶提示**：為最終用戶提供清晰的錯誤提示，而非技術性錯誤資訊。
- **實現方法**：
  - 將 API 請求包裹在重試邏輯中（如設置最大重試次數）。
  - 針對不可恢復的錯誤（如無效貨幣程式碼）回傳錯誤訊息。
- **框架支援**：
  - **Retryable HTTP**：自動處理重試邏輯。
  - **優雅錯誤訊息**：設計自定義錯誤型別，讓開發者與使用者的錯誤資訊區分明確。

---

## **5. 測試**

### **目標**

確保程式邏輯正確並穩定運行，防止潛在問題進入生產環境。

### **實作細節**

- **測試類型**：
  - **單元測試**：測試每個功能模組的邏輯正確性。
  - **整合測試**：測試模組間的互動（如匯率 API 整合）。
  - **邊界測試**：處理極端情況（如匯率為零或負數）。
- **概念與工具**：
  - 使用 `Go testing` 標準庫撰寫單元測試。
  - 使用 mock 技術模擬外部 API 回應。
- **測試覆蓋率目標**：
  - 目標覆蓋率應達到 80% 以上，包括核心功能和錯誤處理邏輯。

---

## **6. 安全性**

### **目標**

保護敏感資料，防止程式因安全問題而受損或洩露數據。

### **實作細節**

- **概念**：
  - **敏感資料隔離**：如 API 金鑰、密碼，只能儲存於安全位置。
  - **加密傳輸**：所有外部 API 請求應透過 HTTPS。
  - **儲存安全性**：如果需要持久化匯率資料，應加密儲存。
- **措施**：
  - 定期輪替 API 金鑰，降低金鑰洩露風險。
  - 使用 Vault 等工具集中管理敏感資料。

---

## **7. 文件與說明**

### **目標**

為開發者和使用者提供清晰的指引，降低學習成本。

### **實作細節**

- **概念**：
  - **README 文件**：描述系統的功能、安裝流程與範例用法。
  - **開發文件**：詳細說明程式碼結構、邏輯與設計考量。
- **應包含內容**：
  - 安裝與執行指引。
  - 支援的貨幣程式碼清單與匯率更新邏輯。
  - 主要錯誤提示及其解決方案。
  - 測試與部署指南。
- **文檔工具**：
  - 使用 Markdown 格式撰寫 README。
  - 如有 REST API，可使用 Swagger 或 Postman 整理 API 文件。

---

## **8. 擴充性**

### **目標**

設計靈活架構，支援新功能的快速整合，提升系統壽命。

### **實作細節**

- **新增貨幣支援**：
  - 設定文件中管理支援的貨幣程式碼和其符號。
  - 動態從 API 獲取可用幣種並更新。
- **多語言支援**：
  - 使用國際化工具，如 `go-i18n`。
  - 定義多語言訊息檔案，讓提示訊息根據用戶語言自動切換。
- **指令列工具**：
  - 支援 CLI 操作，方便開發者在命令列直接執行轉換。
  - 提供選項如 `--currency` 和 `--amount`，並支援 `--help` 指令。

---
